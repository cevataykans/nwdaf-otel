#!/usr/bin/env python3
import numpy as np
import matplotlib
matplotlib.use("pgf")
matplotlib.rcParams.update({
    "pgf.texsystem": "pdflatex",
    "text.usetex": True,
    "pgf.rcfonts": False,
    "font.family": "serif",
    "font.serif": ["Palatino"],
    "axes.labelsize": 11,
    "font.size": 11,
    "legend.fontsize": 10,
    "xtick.labelsize": 10,
    "ytick.labelsize": 10,
})

import matplotlib.pyplot as plt


# ============================================================
# DATA — extend here freely
# ============================================================
data = {

    ###
    #   1 AMF NO LB
    ###

    # 16: [
    #     (432060.375, 180052.75, 84008.625, 167999),
    #     (405520.5625, 152523.375, 87105.1875, 165892),
    #     (531031.375, 76776.3125, 101042.4375, 353212.625),
    #     (480127.1875, 54857.3125, 96108.8125, 329161.0625),
    #     (439541.875, 87017.375, 82541.8125, 269982.6875),
    #     (506494.25, 102691.5, 94031.3125, 309771.4375),
    #     (305915.6875, 70464.125, 75054.1875, 160397.375),
    #     (492078.625, 153328.0625, 84595.875, 254154.6875),
    #     (412248.125, 80396.6875, 66861.1875, 264990.25),
    #     (830948.5, 145664.0625, 132585.625, 552698.8125),
    # ],
    #
    # 32: [
    #     (1.1994779375e6, 143659.46875, 185661.84375, 870156.625),
    #     (573625.125, 92419.53125, 111083.53125, 370122.0625),
    #     (907619.65625, 100716.0625, 163653.96875, 643249.625),
    #     (587115.15625, 114269.65625, 93425.40625, 379420.09375),
    #     (712163.71875, 98217.1875, 119889.8125, 494056.71875),
    #     (1.06081184375e6, 112780.21875, 174938.40625, 773093.21875),
    #     (896388.4375, 112706.125, 195309.8125, 588372.5),
    #     (1.008907625e6, 123565.25, 160773.1875, 724569.1875),
    #     (930675.9375, 135164.78125, 144922.34375, 650588.8125),
    #     (1.0173236875e6, 132297.75, 148525.5, 736500.4375),
    # ],
    #
    # 64: [
    #     (1.763518421875e6, 235986.09375, 348938.4375, 1.178593890625e6),
    #     (1.50049625e6, 161826.453125, 238266.671875, 1.100403125e6),
    #     (2.2424438125e6, 308759.8125, 371978.3125, 1.5617056875e6),
    #     (2.27787526984127e6, 258355.74603174604, 377184.873015873, 1.642334650793651e6),
    #     (1.4210214444444445e6, 136625.22222222222, 267412.90476190473, 1.0169833174603175e6),
    #     (1.762636609375e6, 220546.65625, 342418.734375, 1.19967121875e6),
    #     (1.6328085625e6, 232135.109375, 334699.921875, 1.06597353125e6),
    #     (1.804124359375e6, 337048.71875, 516385.84375, 950689.796875),
    #     (1.752878890625e6, 245291.84375, 317655.515625, 1.18993153125e6),
    #     (2.28977253125e6, 246385.203125, 333717.796875, 1.70966953125e6),
    # ],
    #
    # 128: [
    #     (5.2503824609375e6, 569916.7578125, 1.5242210703125e6, 3.1562446328125e6),
    #     (3.8652342734375e6, 450921.6875, 718158.421875, 2.6961541640625e6),
    #     (3.468628703125e6, 432805.71875, 680103.640625, 2.35571934375e6),
    #     (3.4615759609375e6, 320500.6015625, 486410.765625, 2.65466459375e6),
    #     (3.863208234375e6, 605596.4296875, 701993.4765625, 2.555618328125e6),
    #     (3.7430790078125e6, 526047.2109375, 769847.390625, 2.44718440625e6),
    #     (3.5675777421875e6, 483964.1796875, 669476.765625, 2.414136796875e6),
    #     (5.1085942421875e6, 1.009589828125e6, 1.0648730703125e6, 3.03413134375e6),
    #     (5.150628265625e6, 532954.5703125, 824013.7890625, 3.79365990625e6),
    #     (4.0489067578125e6, 772306.15625, 703401.703125, 2.5731988984375e6),
    # ],
    #
    # 256: [
    #     (9.27366191796875e6, 1.75529765234375e6, 1.4482003203125e6, 6.0701639453125e6),
    #     (8.2919435078125e6, 7.8521825390625e5, 1.21200106640625e6, 6.2947241875e6),
    #     (6.5426269921875e6, 1.2161788125e6, 1.05444756640625e6, 4.27200061328125e6),
    #     (8.7649936875e6, 1.06073179296875e6, 1.3705592890625e6, 6.33370260546875e6),
    #     (9.3484519375e6, 1.48283752734375e6, 1.31519537109375e6, 6.5504190390625e6),
    #     (7.16348826171875e6, 1.2422393671875e6, 1.8264032578125e6, 4.09484563671875e6),
    #     (1.1681888625e7, 2.05898942578125e6, 2.2431807734375e6, 7.37971842578125e6),
    #     (7.801390953125e6, 8.4746485546875e5, 1.14718468359375e6, 5.8067414140625e6),
    #     (1.0545896109375e7, 1.20444687109375e6, 1.6049766171875e6, 7.73647262109375e6),
    #     (8.19821977734375e6, 7.8245336328125e5, 1.14694328125e6, 6.2688231328125e6),
    # ],
    #
    # 384: [
    #     (1.3724509981770834e7, 2.0211388958333333e6, 3.2868395104166665e6, 8.416531575520834e6),
    #     (1.2935155994791666e7, 1.882636484375e6, 2.250530140625e6, 8.801989369791666e6),
    #     (1.6801223572916668e7, 2.05364240625e6, 3.8775190625e6, 1.0870062104166666e7),
    #     (1.43548992890625e7, 2.202056328125e6, 3.7362242395833335e6, 8.416618721354166e6),
    #     (1.4589702463541666e7, 1.6899773489583333e6, 2.0369366796875e6, 1.0862788434895834e7),
    #     (1.4992786932291666e7, 3.1417309375e6, 2.9650142786458335e6, 8.886041716145834e6),
    #     (1.06029437109375e7, 2.2065015390625e6, 2.3109859869791665e6, 6.085456184895833e6),
    #     (1.2827149109375e7, 2.3341400807291665e6, 2.3827294791666665e6, 8.110279549479167e6),
    #     (1.02702559609375e7, 1.4001312838541667e6, 1.6589208020833333e6, 7.211203875e6),
    #     (1.66026147890625e7, 2.0556350182291667e6, 2.9663158723958335e6, 1.15806638984375e7),
    # ],
    #
    # 512: [
    #     (1.7394166189453125e7, 2.883514048828125e6, 2.93249421875e6, 1.1578157921875e7),
    #     (1.8055417580078125e7, 3.72035850390625e6, 3.894236673828125e6, 1.044082240234375e7),
    #     (1.9515586943359375e7, 2.977053615234375e6, 4.692207205078125e6, 1.1846326123046875e7),
    #     (2.0531695642578125e7, 3.338183587890625e6, 3.682366439453125e6, 1.3511145615234375e7),
    #     (1.8893641529296875e7, 2.912384595703125e6, 3.759592849609375e6, 1.2221664083984375e7),
    #     (1.735061234637965e7, 2.7519455753424657e6, 3.2561408454011744e6, 1.1342525925636008e7),
    #     (1.78355375518591e7, 2.8916146673189825e6, 2.886136217221135e6, 1.2057786667318983e7),
    #     (1.715588823046875e7, 2.079607724609375e6, 2.48600296484375e6, 1.2590277541015625e7),
    #     (1.769894387109375e7, 2.008337603515625e6, 2.293079904296875e6, 1.339752636328125e7),
    #     (1.814622705479452e7, 2.179497923679061e6, 3.705754610567515e6, 1.2260974520547945e7),
    # ],

    ###
    #   1 AMF NO LB 1 UDM, 2 UDM, 4 UDM
    ###

}


# ============================================================
# Convert to scatter arrays + median arrays
# ============================================================

def main():
    ue_counts = sorted(data.keys())

    # Scatter data
    x_total = []
    total_s = []

    x1 = []; r1_s = []
    x2 = []; r2_s = []
    x3 = []; r3_s = []

    # Median data
    median_total = []
    median_r1 = []
    median_r2 = []
    median_r3 = []

    for ue in ue_counts:
        group = data[ue]

        totals = np.array([t for (t, _, _, _) in group]) / 1e6
        r1 = np.array([r for (_, r, _, _) in group]) / 1e6
        r2 = np.array([r for (_, _, r, _) in group]) / 1e6
        r3 = np.array([r for (_, _, _, r) in group]) / 1e6

        median_total.append(np.average(totals))
        median_r1.append(np.average(r1))
        median_r2.append(np.average(r2))
        median_r3.append(np.average(r3))

        for (t, a, b, c) in group:
            x_total.append(ue); total_s.append(t / 1e6)
            x1.append(ue); r1_s.append(a / 1e6)
            x2.append(ue); r2_s.append(b / 1e6)
            x3.append(ue); r3_s.append(c / 1e6)

    # ============================================================
    # Plotting
    # ============================================================

    plt.figure(figsize=(6.2, 3.8))

    # Scatter
    sc_total = plt.scatter(x_total, total_s, marker='o', s=2.5, alpha=0.8, label="Total Registration Time")
    sc_r1    = plt.scatter(x1, r1_s, marker='s', s=2.5, alpha=0.8, label="NAS Reg. Req. → NAS Auth. Req.")
    sc_r2    = plt.scatter(x2, r2_s, marker='^', s=2.5, alpha=0.8, label="NAS Auth. Res. → NAS SecModeCmd")
    sc_r3    = plt.scatter(x3, r3_s, marker='D', s=2.5, alpha=0.8, label="NAS SecModeComplete → IniCtxSetup Req.")

    # Median lines (colors taken from scatter collections)
    plt.plot(ue_counts, median_total, "-", color=sc_total.get_facecolor()[0], linewidth=0.8)
    plt.plot(ue_counts, median_r1,    "-", color=sc_r1.get_facecolor()[0],    linewidth=0.8)
    plt.plot(ue_counts, median_r2,    "-", color=sc_r2.get_facecolor()[0],    linewidth=0.8)
    plt.plot(ue_counts, median_r3,    "-", color=sc_r3.get_facecolor()[0],    linewidth=0.8)

    plt.xlabel("Number of User Equipments")
    plt.ylabel("Procedure Time (seconds)")
    plt.grid(True, linestyle='--', linewidth=0.4, alpha=0.7)
    plt.legend()
    plt.tight_layout()

    plt.savefig("reg_times3.png", dpi=300)
    # plt.savefig("reg_times.pgf")  # Optional for native LaTeX

    print("Generated: reg_times2.png")

if __name__ == '__main__':
    main()