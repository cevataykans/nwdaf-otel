import numpy as np
import matplotlib
matplotlib.use("pgf")
matplotlib.rcParams.update({
    "pgf.texsystem": "pdflatex",
    "text.usetex": True,
    "pgf.rcfonts": False,
    "font.family": "serif",
    "font.serif": ["Palatino"],
    "axes.labelsize": 11,
    "font.size": 11,
    "legend.fontsize": 10,
    "xtick.labelsize": 10,
    "ytick.labelsize": 10,
})

import matplotlib.pyplot as plt

# ============================================================
# DATA STRUCTURE
# Each sample = (Total, R1, R2, R3)
# ============================================================

data = {
    'SCTPLB, 2 AMFs, UDM': {
        128: [
            (4.998418e+06, 743404.59375, 845974.65625, 3.40903875e+06),
            (3.6924683828125e+06, 349209.953125, 529618.2109375, 2.81364021875e+06),
            (3.9707406953125e+06, 526540.8828125, 754945.5078125, 2.6892543046875e+06),
            (3.503376328125e+06, 589040.3671875, 707317.625, 2.2070183359375e+06),
            (3.554833984375e+06, 369710.6328125, 535982.21875, 2.6491411328125e+06),
            (4.0525845e+06, 449911.0703125, 631226.3046875, 2.971447125e+06),
            (4.448150724409449e+06, 537332.5275590551, 856825.2992125985, 3.053992897637795e+06),
            (4.5752156796875e+06, 589307.3828125, 791714.15625, 3.194194140625e+06),
            (5.572431359375e+06, 678005.4609375, 1.0131134921875e+06, 3.88131240625e+06),
            (4.6087770390625e+06, 959082.7265625, 1.2911558671875e+06, 2.3585384453125e+06),
        ],
        256: [
            (8.7849216e+06, 1.159440925490196e+06, 1.7325426352941177e+06, 5.892938039215687e+06),
            (7.949339780392157e+06, 1.3663895882352942e+06, 1.7470441137254902e+06, 4.8359060784313725e+06),
            (1.016460237109375e+07, 1.25296430859375e+06, 1.7401655625e+06, 7.1714725e+06),
            (1.0329601749019608e+07, 1.3811890352941176e+06, 1.7812513607843136e+06, 7.167161352941177e+06),
            (1.0393348625e+07, 1.3132868984375e+06, 1.694303515625e+06, 7.3857582109375e+06),
            (8.036199390625e+06, 958562.890625, 1.20158501171875e+06, 5.87605148828125e+06),
            (9.58562980078125e+06, 1.23430694921875e+06, 1.8303882421875e+06, 6.520934609375e+06),
            (8.58106660546875e+06, 1.39879705078125e+06, 1.88852003515625e+06, 5.29374951953125e+06),
            (8.769677890625e+06, 955727.54296875, 1.30624209375e+06, 6.50770825390625e+06),
            (9.215143074509803e+06, 984479.5019607843, 1.6453141529411764e+06, 6.585349419607843e+06),
        ],
        384: [
            (1.499659161618799e+07, 2.1157377206266318e+06, 2.7365852924281983e+06, 1.0144268603133159e+07),
            (1.8464010669270832e+07, 1.9419907421875e+06, 3.8562900546875e+06, 1.2665729872395834e+07),
            (1.5598905216145834e+07, 1.6869595130208333e+06, 2.78414134375e+06, 1.1127804359375e+07),
            (1.3001966973958334e+07, 1.7955147109375e+06, 2.2778734375e+06, 8.928578825520834e+06),
            (1.8582508291666668e+07, 2.4157503880208335e+06, 3.6647453489583335e+06, 1.25020125546875e+07),
            (1.7409804661458332e+07, 2.8734630130208335e+06, 3.3298881432291665e+06, 1.1206453505208334e+07),
            (1.48251111171875e+07, 2.9570935208333335e+06, 2.816097296875e+06, 9.051920299479166e+06),
            (1.4768175028645834e+07, 1.9190090442708333e+06, 3.4586502083333335e+06, 9.390515776041666e+06),
            (1.767932078067885e+07, 2.4114005378590077e+06, 3.5456583759791125e+06, 1.1722261866840731e+07),
            (1.7047882807291668e+07, 1.9489260677083333e+06, 2.384990984375e+06, 1.2713965755208334e+07),
        ],
        512: [
            (2.13515312265625e+07, 3.17702057421875e+06, 4.585508951171875e+06, 1.3589001701171875e+07),
            (1.95939398671875e+07, 3.289632453125e+06, 2.497574263671875e+06, 1.3806733150390625e+07),
            (2.17292714140625e+07, 3.2580846015625e+06, 4.190074181640625e+06, 1.4281112630859375e+07),
            (2.2052588041015625e+07, 3.459460634765625e+06, 3.7252232734375e+06, 1.48679041328125e+07),
            (2.1193940044921875e+07, 3.447823115234375e+06, 5.11031745703125e+06, 1.263579947265625e+07),
            (1.88950654765625e+07, 3.262943560546875e+06, 4.464844072265625e+06, 1.116727784375e+07),
            (2.0348876405088063e+07, 4.0515644168297458e+06, 3.459515029354207e+06, 1.283779695890411e+07),
            (1.998955740625e+07, 3.62615801953125e+06, 3.179950138671875e+06, 1.3183449248046875e+07),
            (1.999202109411765e+07, 4.230787478431373e+06, 3.8926864784313724e+06, 1.1868547137254901e+07),
            (2.0537657046875e+07, 3.20201729296875e+06, 3.8813274921875e+06, 1.345431226171875e+07),
        ],
    },
    'SCTPLB, AMF, UDM': {
        128: [
            (4.6624963046875e+06, 521034.640625, 794705.921875, 3.3467557421875e+06),
            (4.1598866796875e+06, 374961.109375, 696623.4140625, 3.08830215625e+06),
            (5.91731065625e+06, 575208.578125, 1.691989828125e+06, 3.65011225e+06),
            (5.1523301640625e+06, 588592.5625, 862139.015625, 3.7015985859375e+06),
            (4.1628422265625e+06, 390016.828125, 363153.8125, 3.4096715859375e+06),
            (3.191127953125e+06, 372414.734375, 412040.6640625, 2.4066725546875e+06),
            (4.73981603125e+06, 511952.4765625, 776374.140625, 3.4514894140625e+06),
            (5.507020640625e+06, 550696.2109375, 875201.671875, 4.0811227578125e+06),
            (4.30018703125e+06, 401436.453125, 613105.6640625, 3.2856449140625e+06),
            (4.4096899609375e+06, 525543.765625, 782090.2578125, 3.1020559375e+06),
        ],
        256: [
            (9.362208694117647e+06, 1.3018392e+06, 1.2777479137254902e+06, 6.782621580392157e+06),
            (1.105650976953125e+07, 1.183555265625e+06, 1.7450211015625e+06, 8.12793340234375e+06),
            (7.99806547265625e+06, 1.2088651484375e+06, 1.616150078125e+06, 5.17305024609375e+06),
            (1.043995335546875e+07, 999038.30859375, 1.345589140625e+06, 8.09532590625e+06),
            (1.011611546875e+07, 1.03872721875e+06, 1.600689453125e+06, 7.476698796875e+06),
            (1.096106975390625e+07, 1.117182390625e+06, 1.9829099140625e+06, 7.86097744921875e+06),
            (1.156103842578125e+07, 964400.82421875, 1.41855587890625e+06, 9.17808172265625e+06),
            (7.05375544921875e+06, 751621.52734375, 1.110850890625e+06, 5.19128303125e+06),
            (1.0859966e+07, 1.1365100666666667e+06, 2.4410653960784315e+06, 7.282390537254902e+06),
            (9.53118856640625e+06, 1.17783327734375e+06, 1.40560487109375e+06, 6.94775041796875e+06),
        ],
        384: [
            (1.6371043953125e+07, 1.8466021979166667e+06, 2.4774781536458335e+06, 1.20469636015625e+07),
            (1.591655559375e+07, 1.4024895520833333e+06, 1.8472545598958333e+06, 1.2666811481770834e+07),
            (1.6990993265625e+07, 2.0406557526041667e+06, 2.9509317369791665e+06, 1.1999405776041666e+07),
            (1.56647981640625e+07, 1.6038894296875e+06, 2.573638265625e+06, 1.148727046875e+07),
            (1.6014383817708334e+07, 2.5046252786458335e+06, 3.1422739635416665e+06, 1.0367484575520834e+07),
            (1.6213961307291666e+07, 1.990138453125e+06, 2.5602647317708335e+06, 1.1663558122395834e+07),
            (1.6784540036458332e+07, 2.4191424921875e+06, 3.301245515625e+06, 1.1064152028645834e+07),
            (1.47181147109375e+07, 2.3260487682291665e+06, 2.2876934765625e+06, 1.0104372466145834e+07),
            (1.6234751650130548e+07, 1.9634236318537858e+06, 2.8835044751958223e+06, 1.138782354308094e+07),
            (1.5661979578534031e+07, 1.8548970418848167e+06, 2.6694657486910997e+06, 1.1137616787958115e+07),
        ],
        512: [
            (2.3230108568359375e+07, 2.87169687109375e+06, 3.488304021484375e+06, 1.687010767578125e+07),
            (2.153143366015625e+07, 3.268164771484375e+06, 3.9148936328125e+06, 1.4348375255859375e+07),
            (1.9743196501953125e+07, 2.23804478125e+06, 3.39602928125e+06, 1.4109122439453125e+07),
            (2.3280654826171875e+07, 4.01970173828125e+06, 4.236587859375e+06, 1.5024365228515625e+07),
            (2.109254880078125e+07, 4.049039552734375e+06, 4.06573684375e+06, 1.2977772404296875e+07),
            (2.1884892783203125e+07, 2.638243947265625e+06, 3.34060999609375e+06, 1.590603883984375e+07),
            (2.684704928125e+07, 3.893702408203125e+06, 4.1593638671875e+06, 1.8793983005859375e+07),
            (2.002357316438356e+07, 2.7108058023483367e+06, 2.8741664657534244e+06, 1.4438600896281801e+07),
            (2.1201097728515625e+07, 3.20376078515625e+06, 3.971662447265625e+06, 1.402567449609375e+07),
            (2.2237607833984375e+07, 2.877906896484375e+06, 3.696215978515625e+06, 1.5663484958984375e+07),
        ],
    },
    'SCTPLB, 2 AMFs, 2 UDMs': {
        128: [
            (4.607970609375e+06, 1.040644921875e+06, 1.322544921875e+06, 2.244780765625e+06),
            (2.719300546875e+06, 529716.7890625, 612121.5390625, 1.57746221875e+06),
            (3.534449296875e+06, 653326.453125, 748944.234375, 2.132178609375e+06),
            (4.36029084375e+06, 744257.65625, 1.1771097578125e+06, 2.4389234296875e+06),
            (2.9587154921875e+06, 530310.578125, 527844.8203125, 1.90056009375e+06),
            (3.429648625e+06, 558950.1484375, 646033.9140625, 2.2246645625e+06),
            (3.3336564765625e+06, 719221.59375, 566704.78125, 2.0477301015625e+06),
            (3.2917785546875e+06, 620541.1328125, 801365.09375, 1.869872328125e+06),
            (5.185841671875e+06, 664119.859375, 807943.1484375, 3.7137786640625e+06),
            (2.9093037109375e+06, 506869.5859375, 542483.765625, 1.859950359375e+06),
        ],
        256: [
            (8.658714682352941e+06, 1.3654656627450981e+06, 1.7295304078431372e+06, 5.563718611764706e+06),
            (8.618542149019608e+06, 1.0793062470588235e+06, 1.3632582352941176e+06, 6.175977666666667e+06),
            (8.72989536328125e+06, 1.5509778125e+06, 2.7763765625e+06, 4.40254098828125e+06),
            (8.4580481875e+06, 1.2544931328125e+06, 1.681503328125e+06, 5.5220517265625e+06),
            (8.256207e+06, 1.203300484375e+06, 1.70810544921875e+06, 5.34480106640625e+06),
            (6.87916462109375e+06, 1.13652878515625e+06, 1.57618333984375e+06, 4.16645249609375e+06),
            (8.521628859375e+06, 1.28470716796875e+06, 1.63011840234375e+06, 5.6068032890625e+06),
            (6.5696436953125e+06, 1.15857984765625e+06, 1.530755203125e+06, 3.88030864453125e+06),
            (8.15947564453125e+06, 1.29114236328125e+06, 1.684034578125e+06, 5.184298703125e+06),
            (8.92875923828125e+06, 1.1386543359375e+06, 2.04536546875e+06, 5.74473943359375e+06),
        ],
        384: [
            (1.2210732078125e+07, 1.9438184869791667e+06, 2.7884761875e+06, 7.478437403645833e+06),
            (1.4219774346354166e+07, 2.27605121875e+06, 3.3008872838541665e+06, 8.64283584375e+06),
            (1.2741539692708334e+07, 2.0256528333333333e+06, 3.6108295520833335e+06, 7.105057307291667e+06),
            (1.3944252080729166e+07, 2.0694064661458333e+06, 3.1895471979166665e+06, 8.685298416666666e+06),
            (1.2122207169712793e+07, 1.8694091514360313e+06, 2.8549168459530026e+06, 7.39788117232376e+06),
            (1.2240365880208334e+07, 1.9810860286458333e+06, 2.5449089036458335e+06, 7.714370947916667e+06),
            (1.223431625e+07, 1.95422359375e+06, 3.4488043958333335e+06, 6.831288260416667e+06),
            (1.1552896809895834e+07, 2.0268295651041667e+06, 2.6309076770833335e+06, 6.895159567708333e+06),
            (1.2188353364583334e+07, 1.7807073958333333e+06, 2.0331874453125e+06, 8.3744585234375e+06),
            (1.2334409700520834e+07, 2.1344197734375e+06, 2.7001267057291665e+06, 7.499863221354167e+06),
        ],
        512: [
            (1.5501376647058824e+07, 2.4887565176470587e+06, 3.1679180235294118e+06, 9.844702105882352e+06),
            (1.9486690275390625e+07, 3.027675943359375e+06, 4.9279657109375e+06, 1.153104862109375e+07),
            (1.7448836272015657e+07, 2.6031855479452056e+06, 3.6402211428571427e+06, 1.1205429581213307e+07),
            (1.8381810033203125e+07, 2.7233759140625e+06, 4.9490289140625e+06, 1.0709405205078125e+07),
            (1.7357933166015625e+07, 2.401395453125e+06, 4.25954791796875e+06, 1.0696989794921875e+07),
            (1.72252975859375e+07, 2.65172545703125e+06, 3.7202726640625e+06, 1.085329946484375e+07),
            (1.7280929783203125e+07, 2.825886544921875e+06, 4.048932158203125e+06, 1.0406111080078125e+07),
            (1.6368341767578125e+07, 2.42553340625e+06, 3.22417851171875e+06, 1.0718629849609375e+07),
            (1.68798697734375e+07, 2.680297521484375e+06, 3.502452111328125e+06, 1.0697120140625e+07),
            (1.8818700931640625e+07, 3.1217441640625e+06, 4.308134923828125e+06, 1.138882184375e+07),
        ]
    },
    "AMF, UDM": {
        128: [
            (5.2503824609375e+06, 569916.7578125, 1.5242210703125e+06, 3.1562446328125e+06),
            (3.8652342734375e+06, 450921.6875, 718158.421875, 2.6961541640625e+06),
            (3.468628703125e+06, 432805.71875, 680103.640625, 2.35571934375e+06),
            (3.4615759609375e+06, 320500.6015625, 486410.765625, 2.65466459375e+06),
            (3.863208234375e+06, 605596.4296875, 701993.4765625, 2.555618328125e+06),
            (3.7430790078125e+06, 526047.2109375, 769847.390625, 2.44718440625e+06),
            (3.5675777421875e+06, 483964.1796875, 669476.765625, 2.414136796875e+06),
            (5.1085942421875e+06, 1.009589828125e+06, 1.0648730703125e+06, 3.03413134375e+06),
            (5.150628265625e+06, 532954.5703125, 824013.7890625, 3.79365990625e+06),
            (4.0489067578125e+06, 772306.15625, 703401.703125, 2.5731988984375e+06),
        ],
        256: [
            (9.27366191796875e+06, 1.75529765234375e+06, 1.4482003203125e+06, 6.0701639453125e+06),
            (8.2919435078125e+06, 785218.25390625, 1.21200106640625e+06, 6.2947241875e+06),
            (6.5426269921875e+06, 1.2161788125e+06, 1.05444756640625e+06, 4.27200061328125e+06),
            (8.7649936875e+06, 1.06073179296875e+06, 1.3705592890625e+06, 6.33370260546875e+06),
            (9.3484519375e+06, 1.48283752734375e+06, 1.31519537109375e+06, 6.5504190390625e+06),
            (7.16348826171875e+06, 1.2422393671875e+06, 1.8264032578125e+06, 4.09484563671875e+06),
            (1.1681888625e+07, 2.05898942578125e+06, 2.2431807734375e+06, 7.37971842578125e+06),
            (7.801390953125e+06, 847464.85546875, 1.14718468359375e+06, 5.8067414140625e+06),
            (1.0545896109375e+07, 1.20444687109375e+06, 1.6049766171875e+06, 7.73647262109375e+06),
            (8.19821977734375e+06, 782453.36328125, 1.14694328125e+06, 6.2688231328125e+06),
        ],
        384: [
            (1.3724509981770834e+07, 2.0211388958333333e+06, 3.2868395104166665e+06, 8.416531575520834e+06),
            (1.2935155994791666e+07, 1.882636484375e+06, 2.250530140625e+06, 8.801989369791666e+06),
            (1.6801223572916668e+07, 2.05364240625e+06, 3.8775190625e+06, 1.0870062104166666e+07),
            (1.43548992890625e+07, 2.202056328125e+06, 3.7362242395833335e+06, 8.416618721354166e+06),
            (1.4589702463541666e+07, 1.6899773489583333e+06, 2.0369366796875e+06, 1.0862788434895834e+07),
            (1.4992786932291666e+07, 3.1417309375e+06, 2.9650142786458335e+06, 8.886041716145834e+06),
            (1.06029437109375e+07, 2.2065015390625e+06, 2.3109859869791665e+06, 6.085456184895833e+06),
            (1.2827149109375e+07, 2.3341400807291665e+06, 2.3827294791666665e+06, 8.110279549479167e+06),
            (1.02702559609375e+07, 1.4001312838541667e+06, 1.6589208020833333e+06, 7.211203875e+06),
            (1.66026147890625e+07, 2.0556350182291667e+06, 2.9663158723958335e+06, 1.15806638984375e+07),
        ],
        512: [
            (1.7394166189453125e+07, 2.883514048828125e+06, 2.93249421875e+06, 1.1578157921875e+07),
            (1.8055417580078125e+07, 3.72035850390625e+06, 3.894236673828125e+06, 1.044082240234375e+07),
            (1.9515586943359375e+07, 2.977053615234375e+06, 4.692207205078125e+06, 1.1846326123046875e+07),
            (2.0531695642578125e+07, 3.338183587890625e+06, 3.682366439453125e+06, 1.3511145615234375e+07),
            (1.8893641529296875e+07, 2.912384595703125e+06, 3.759592849609375e+06, 1.2221664083984375e+07),
            (1.735061234637965e+07, 2.7519455753424657e+06, 3.2561408454011744e+06, 1.1342525925636008e+07),
            (1.78355375518591e+07, 2.8916146673189825e+06, 2.886136217221135e+06, 1.2057786667318983e+07),
            (1.715588823046875e+07, 2.079607724609375e+06, 2.48600296484375e+06, 1.2590277541015625e+07),
            (1.769894387109375e+07, 2.008337603515625e+06, 2.293079904296875e+06, 1.339752636328125e+07),
            (1.814622705479452e+07, 2.179497923679061e+06, 3.705754610567515e+06, 1.2260974520547945e+07),
        ],
    },
    'AMF, 2 UDMs': {
        128: [
            (3.58003946875e+06, 604466.5234375, 687176.5078125, 2.2883964375e+06),
            (3.3779555433070865e+06, 489777.7165354331, 686950.1181102362, 2.2012277086614175e+06),
            (2.735197748031496e+06, 412788.6535433071, 562974.0236220473, 1.7594350708661417e+06),
            (3.109113796875e+06, 495926.8671875, 679646.3046875, 1.933540625e+06),
            (2.9478783385826773e+06, 448724.83464566927, 782182.0787401575, 1.7169714251968504e+06),
            (4.517728140625e+06, 884284.3125, 1.18618071875e+06, 2.447263109375e+06),
            (4.17457053125e+06, 341642, 679459.6328125, 3.1534688984375e+06),
            (2.8066513984375e+06, 391687.7578125, 573602.484375, 1.84136115625e+06),
            (3.05900025e+06, 423473.4296875, 566486.9609375, 2.069039859375e+06),
            (2.2471544453125e+06, 308120.3046875, 409743.0546875, 1.5292910859375e+06),
        ],
        256: [
            (7.2281937450980395e+06, 795475.8470588236, 1.2067366196078432e+06, 5.225981278431373e+06),
            (6.56717585546875e+06, 1.06545576171875e+06, 1.813305390625e+06, 3.688414703125e+06),
            (7.34190280078125e+06, 1.92510055859375e+06, 1.679485359375e+06, 3.7373168828125e+06),
            (7.187227937254902e+06, 1.0300930901960784e+06, 1.4672224588235293e+06, 4.689912388235294e+06),
            (7.744964181102362e+06, 1.5707779212598426e+06, 2.4113926338582677e+06, 3.762793625984252e+06),
            (6.119126968627451e+06, 650771.6431372549, 1.0052329019607843e+06, 4.463122423529412e+06),
            (7.301501717647059e+06, 899577.7921568628, 2.12083808627451e+06, 4.281085839215687e+06),
            (4.9628153671875e+06, 703177.5546875, 1.036211703125e+06, 3.223426109375e+06),
            (6.818886859375e+06, 896465.109375, 1.25639305078125e+06, 4.66602869921875e+06),
            (7.5324153046875e+06, 845356.25390625, 1.254355640625e+06, 5.43270341015625e+06),
        ],
        384: [
            (9.853972559895834e+06, 1.3809622161458333e+06, 2.4754367395833335e+06, 5.997573604166667e+06),
            (1.0851334119791666e+07, 1.7229273645833333e+06, 2.5671946432291665e+06, 6.561212111979167e+06),
            (1.2925637744791666e+07, 2.2401592109375e+06, 3.34724390625e+06, 7.338234627604167e+06),
            (1.10661398046875e+07, 1.5719287708333333e+06, 2.4171415182291665e+06, 7.077069515625e+06),
            (1.0187479520833334e+07, 1.6074795989583333e+06, 2.2584739739583335e+06, 6.321525947916667e+06),
            (1.0657682550913839e+07, 1.3499542140992167e+06, 3.1203150626631854e+06, 6.187413274151436e+06),
            (1.1682999078328982e+07, 1.9273542167101828e+06, 2.971500892950392e+06, 6.784143968668408e+06),
            (1.13453649296875e+07, 2.776549390625e+06, 2.7797071744791665e+06, 5.789108364583333e+06),
            (1.0818497947780678e+07, 1.4966632375979112e+06, 2.8217042637075717e+06, 6.500130446475196e+06),
            (1.2284041078125e+07, 1.5692709140625e+06, 2.7838838489583335e+06, 7.930886315104167e+06),
        ],
        512: [
            (1.466347631640625e+07, 2.175991962890625e+06, 3.1807746328125e+06, 9.306709720703125e+06),
            (1.4646902708984375e+07, 2.043738322265625e+06, 3.219582681640625e+06, 9.383581705078125e+06),
            (1.5455512591796875e+07, 3.210339935546875e+06, 3.491532728515625e+06, 8.753639927734375e+06),
            (1.49035297109375e+07, 2.207466205078125e+06, 3.206929921875e+06, 9.489133583984375e+06),
            (1.487571684765625e+07, 2.087670064453125e+06, 2.917991482421875e+06, 9.87005530078125e+06),
            (1.5882075048828125e+07, 1.964840912109375e+06, 3.3783974609375e+06, 1.053883667578125e+07),
            (1.5436853765625e+07, 3.09792136328125e+06, 3.2611709375e+06, 9.07776146484375e+06),
            (1.513145425390625e+07, 1.790062490234375e+06, 3.4500934765625e+06, 9.891298287109375e+06),
            (1.5670196458984375e+07, 2.272093794921875e+06, 4.615236013671875e+06, 8.782866650390625e+06),
            (1.4746112599609375e+07, 1.938904984375e+06, 2.952836064453125e+06, 9.85437155078125e+06),
        ]
    }
}

# ============================================================
# PLOTTING
# ============================================================

def main():
    line_list = sorted(data.keys())
    ue_counts = sorted(list(data[line_list[0]].keys()))

    # Figure with 4 subplots
    fig, axs = plt.subplots(2, 2, figsize=(8, 8))
    axs = axs.flatten()

    titles = [
        "Total Registration Time",
        "NAS Reg. Req. → NAS Auth. Req.",
        "NAS Auth. Res. → NAS SecModeCmd",
        "NAS SecModeComplete → IniCtxSetup Req."
    ]

    metric_index = [0, 1, 2, 3]  # which value in the tuple

    for plot_idx in range(4):
        ax = axs[plot_idx]
        mi = metric_index[plot_idx]

        for line in line_list:
            scatter_x = []
            scatter_y = []
            avg_y = []

            for ue in ue_counts:
                samples = data[line][ue]

                vals = np.array([row[mi] for row in samples]) / 1e6
                avg = np.average(vals)
                avg_y.append(avg)

                scatter_x.extend([ue] * len(vals))
                scatter_y.extend(vals)

            # scatter
            ax.scatter(scatter_x, scatter_y, s=2.5, alpha=0.70, label=f'{line}')

            # average line
            ax.plot(ue_counts, avg_y, linewidth=0.8)

        ax.set_title(titles[plot_idx])
        ax.set_xlabel("User Equipment Count")
        ax.set_ylabel("Duration (s)")
        ax.grid(True, linestyle='--', linewidth=0.4, alpha=0.6)
        ax.legend(fontsize=7)

    plt.tight_layout()
    plt.savefig("amf_scaling.png", dpi=300)

if __name__ == "__main__":
    main()